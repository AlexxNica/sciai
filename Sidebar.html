<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <!-- The CSS package above applies Google styling to buttons and other elements. -->

    <style>
    .branding-below {
      bottom: 56px;
      top: 0;
    }

    .branding-text {
      left: 7px;
      position: relative;
      top: 3px;
    }

    .col-contain {
      overflow: hidden;
    }

    .col-one {
      float: left;
      width: 50%;
    }

    .logo {
      vertical-align: middle;
    }

    .radio-spacer {
      height: 20px;
    }

    .width-100 {
      width: 100%;
    }
    
    .clickable {
      cursor: pointer;
    }
    
    textarea {resize: none}
    
.accordion-inner {
    background:white;
    display:none;
    padding:5px;
}

#accordion a {
    display:block;
    height:40px;
    line-height:40px;
    text-decoration:none;
}

.arrow {
  width: 200px;
  margin: 0 0 25px 0;
  position: relative;
}

.arrow:after {
	content: '';
	display: block;  
	position: absolute;
	left: 0;
	top: 100%;
	width: 0;
	height: 0;
	border-right: 100px solid transparent;
	border-bottom: 0 solid transparent;
	border-left: 100px solid transparent;
}

.arrow.blue:after {
    border-top: 20px solid #4787ed;
}

.arrow.green:after {
    border-top: 20px solid #398a00;
}


.arrows {
  width: 200px;
  margin-left: auto;
  margin-right: auto;
}

.inline {
  display: inline-block;
}

p.inline{
  font-size: 10px;
  margin: 5px !important;
  font-weight: 300;
}

.no-margin {
  margin: 0;
}

.accordion-arrow {
  font-size: 16px;
  float: right;
  margin-right: 10px;
}

img.logo {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.company-name {
  text-align: center;
  display: block;
}

.sidebar.bottom {
  background-color: white;
}
  
    </style>
  </head>
  <body>
    <div class="sidebar branding-below">
      <!-- Test -->
      
      <div id="accordion">
    <a href="#structure" class="button grey closed">Document Structure <span class="accordion-arrow">⤵</span></a>
    <div class="accordion-inner" id="structure">
        <div class="block arrows">
          <button class="blue arrow" id="insert-title">Title</button>
          <button class="blue arrow" id="insert-authors">Authors</button>
          <button class="blue arrow" id="insert-abstract">Abstract</button>
          <button class="blue arrow" id="insert-introduction">Introduciton</button>
          <button class="blue arrow" id="insert-method">Method</button>
          <button class="blue arrow" id="insert-result">Result</button>
          <button class="blue arrow" id="insert-discussion">Discussion</button>
        </div>
    </div>
    
    <a href="#search" class="button grey closed">Search <span class="accordion-arrow">⤵</span></a>
    <div class="accordion-inner" id="search">
        <form>
        
        <div class="block">
          <button class="white" id="search-term">Search</button>
        </div>
        
        <div class="block" id="search-results"></div>
        
        <div class="block form-group">
          <label for="preview-text"><b>Preview</b></label>
          <textarea disabled class="width-100" id="preview-text" rows="2"></textarea>
        </div>

       <div class="block" id="button-bar">
          <button class="blue" id="replace-text">Wrap</button>
        </div>
      </form>
    </div>
    
    <a href="#elements" class="button grey closed">Elements <span class="accordion-arrow">⤵</span></a>
    <div class="accordion-inner" id="elements">
        
        <form>
        <div class="block form-group">
          <label for="type-of-element"><b>Type of element</b></label>
          <select class="width-100" id="type-of-element">
            <option value="select">Select</option>
            <option value="organism">Organisms</option>
            <option value="drug">Drugs</option>
            <option value="gene">Genes</option>
          </select>
        </div>
        
        <div class="block form-group">
          <label for="preview-element"><b>Preview</b></label>
          <textarea disabled class="width-100" id="preview-element" rows="2"></textarea>
        </div>

       <div class="block" id="button-bar">
          <button class="blue" id="make-term">Make</button>
          <button class="blue" id="wrap-element">Wrap</button>
        </div>
      </form>
        
    </div>
    
</div>
      
      <!-- /Test -->
      
      
    </div>

    <div class="sidebar bottom">
      <div style="width: 49%; float: left;">
        <img alt="Add-on logo" class="logo" src="https://googledrive.com/host/0B3xm1gEWudx0RmZrQS1ZdEdsbnc" width="27" height="27">
        <span class="gray company-name">Xpansa Group</span>
      </div>
      
      <div style="width: 50%; float: right;">
        <img alt="Add-on logo" class="logo" src="https://googledrive.com/host/0B3xm1gEWudx0U2FFbTJqLW1tclk" width="27" height="27">
        <span class="gray company-name">Infinity Sciences</span>
      </div>
      <!--<img alt="Add-on logo" class="logo" src="https://xpansa.com/wp-content/uploads/2015/06/Xpansa_logo_2015.png" width="50" height="50">
      <span class="gray branding-text">Xpansa Group</span>-->
      
    </div>
    <div id="div1">
    </div>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    <script>
      /**
       * On document load, assign click handlers to each button and try to load the
       * user's origin and destination language preferences if previously set.
       */
      $(function() {
        console.log("Loaded");
        
        // Test
        
        // display the first div by default.
//$("#accordion div").first().css('display', 'block');

// Get all the links.
var link = $("#accordion a");

// On clicking of the links do something.
link.on('click', function(e) {
    e.preventDefault();
    var a = $(this).attr("href");
    if($(this).hasClass('closed')) {
      $(a).slideDown('fast')
      $(this).removeClass('closed').addClass('opened');
      $(this).children('.accordion-arrow').html('⤴');
      $(".accordion-inner").not(a).slideUp('fast');
      $(".accordion-arrow").not($(this).children('.accordion-arrow')).html('⤵');
    }
    else {
      $(a).slideUp('fast');
      $(this).children('.accordion-arrow').html('⤵');
      $(this).removeClass('opened').addClass('closed');
      //$(".accordion-inner").not(a).slideDown('fast');
      //$(".accordion-arrow").not($(this).children('.accordion-arrow')).html('⤵');
    }
    //$(a).slideDown('fast');
    //$(this).children('.accordion-arrow').html('⤴');
    //$(a).slideToggle('fast');
    //$(".accordion-inner").not(a).slideUp('fast');
    //$(".accordion-arrow").not($(this).children('.accordion-arrow')).html('⤵');
});
        
        // Test
        
        $( "button[id*='insert-']" ).unbind().click(function(event) {
	  var id = event.currentTarget.id;
	  var tag = id.split("insert-")[1];
	  google.script.run
            .withSuccessHandler(
              function(returnSuccess, element) {
                $(event.currentTarget).removeClass('blue').addClass('green');
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .insertText('<' + tag + '> \n\n </' + tag + '>\n');
});
        
        
        // test
        
        
        
        $('#search-term').click(searchTerm);
        $('#replace-text').click(insertText);
        $('#wrap-element').click(wrapElement);
        $('#make-term').click(makeTerm);
      });
      
      /**
       * Runs a server-side function to translate the user-selected text and update
       * the sidebar UI with the resulting translation.
       */
      function searchTerm() {
        console.log("Searching...");
        this.disabled = true;
        $('#error').remove();
        google.script.run
            .withSuccessHandler(
              function(searchResult, element) {
                console.log("Successfully!");
                $('#search-results').empty();
                if(searchResult.length > 0) {
                  console.log("Number of results: " + searchResult.length);
                  for(var i = 0, j = searchResult.length; i < j; i++) {
                    var id = searchResult[i].id;
                    var type = searchResult[i].type;
                    var header = '<h2 class="inline">' + (i+1) + ' ' + searchResult[i].name + '<p class="inline">'  + searchResult[i].type + '</p></h2>';
                    var content = '<p class="no-margin">' + searchResult[i].description + '</p>';
                    $('#search-results').append('<div id="' + id + '" type="' + type +'" class="clickable"></div');
                    $('#' + id).append(header, content);
                    if (i !== j-1) {
                      $('#' + id).append('<hr>');
                    }
                  }
                }
                else {
                  $('#search-results').append('<p>Sorry, but there is no results...</p>');
                }
                
                $('.clickable').unbind().click(function(event) {
                  console.log("Clicked on " + event.currentTarget.id);
                  var id = event.currentTarget.id;
                  var type = $(event.currentTarget).attr('type');
                  
                  google.script.run
                    .withSuccessHandler(
                      function(processedText, element) {
                        $('#preview-text').val(processedText);
                        element.disabled = false;
                      })
                    .withFailureHandler(
                      function(msg, element) {
                        showError(msg, $('#button-bar'));
                        element.disabled = false;
                      })
                    .withUserObject(this)
                    .runProcessing(type, id);
                })
                element.disabled = false;
              })              
            .withFailureHandler(
              function(msg, element) {
                console.log("Something goes wrong!");
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .searchTerm();
      }
      
      /**
       * Runs a server-side function to translate the user-selected text and update
       * the sidebar UI with the resulting translation.
       */
      function makeTerm() {
        this.disabled = true;
        $('#error').remove();
        var type = $('#type-of-element').val();
        console.log(type);
        console.log($('#type-of-element'));
        google.script.run
            .withSuccessHandler(
              function(processedText, element) {
                $('#preview-element').val(processedText);
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .runProcessing(type);
      }

      /**
       * Runs a server-side function to insert the translated text into the document
       * at the user's cursor or selection.
       */
      function insertText() {
        this.disabled = true;
        $('#error').remove();
        google.script.run
            .withSuccessHandler(
              function(returnSuccess, element) {
                $('#search-results').empty();
                $('#preview-text').val('');
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .insertText($('#preview-text').val());
      }
      
      function wrapElement() {
        this.disabled = true;
        $('#error').remove();
        google.script.run
            .withSuccessHandler(
              function(returnSuccess, element) {
                $('#preview-element').val('');
                element.disabled = false;
              })
            .withFailureHandler(
              function(msg, element) {
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .insertText($('#preview-element').val());
      }

      /**
       * Inserts a div that contains an error message after a given element.
       *
       * @param msg The error message to display.
       * @param element The element after which to display the error.
       */
      function showError(msg, element) {
        var div = $('<div id="error" class="error">' + msg + '</div>');
        $(element).after(div);
      }
    </script>
  </body>
</html>
